# Simple script to download articles from BMC Bioinformatics
library(XML)
library(httr)
library(openxlsx)
# returns string w/o leading whitespace
trim.leading <- function (x)  sub("^\\s+", "", x)
# returns string w/o trailing whitespace
trim.trailing <- function (x) sub("\\s+$", "", x)
# returns string w/o leading or trailing whitespace
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
url <- "https://egov.uscis.gov/casestatus/mycasestatus.do"
## Check status using list of case numbers
cases <- unlist(strsplit(readLines("/Users/ilya/Dropbox/EB/EB2NIW/my/I-485/transfers to nbc.txt"), "\n"))
d <- data.frame(receipt= NA, status = NA, description=NA)
for(c in cases)
{
print(c)
body <- list(appReceiptNum=c)
r <- POST(url=url, body = body, encode="multipart")
dat <- content(r, "text")
doc <- htmlParse(dat)
nodeFound <- xpathApply(doc, "//div[@class=\"current-status-sec\"]") #/html/body/pre/span[374]/a
val <- xmlValue(nodeFound[[1]])
nodeFoundExtn <- xpathApply(doc, "//div[@class=\"rows text-center\"]")
valExtn <- xmlValue(nodeFoundExtn[[1]])
rw <- data.frame(receipt=c, status=trim(unlist(strsplit(val, "\r\n\t        "))[3]), description=trim(unlist(strsplit(valExtn, "\r\n\t        "))[3]))
d <- rbind(d, rw)
free(doc)
Sys.sleep(2)
}
#write.xlsx(x=d[-1,], "/Users/ilya/Dropbox/EB/30min_rep.xlsx")
Sys.time()
View(d)
